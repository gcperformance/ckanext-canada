{% set lang = h.lang() %}

{% set home_link_title = _('Registry Home') %}
{% if not g.is_registry %}
  {% set home_link_title = _('Open Government Portal') %}
{% endif %}

{% set breadcrumbs = [] %}
{# TODO: solve the breadcrumbing #}
{% if breadcrumb_content|trim %}
  {% do breadcrumbs.append({"title": home_link_title, "href": '/' ~ (lang or 'en')}) %}
  {% do breadcrumbs.append({"title": page_title, "href": h.current_url()}) %}
{% endif %}

{# See: https://github.com/wet-boew/cdts-sgdc/blob/v4.1.0/src/gcweb/appTop.ejs #}
{# See: https://github.com/wet-boew/cdts-sgdc/blob/v4.1.0/src/gcweb/top.ejs #}
<script>
  let appTop = document.getElementById("app-top");
  if( appTop ){
    {% if g.is_registry %}
      appTop.outerHTML = wet.builder.appTop({
        "search": false,
        "lngLinks": [
          {
            "lang": "{{ 'en' if lang == 'fr' else 'fr' }}",
            "href": "{{ h.url_for(h.current_url(), locale=('en' if lang == 'fr' else 'fr')) }}",
            "text": "{{ 'English' if lang == 'fr' else 'Français' }}",
          }
        ],
        "menuPath": "{{ h.url_for('canada.site_menu') }}",
        "breadcrumbs": {{ breadcrumbs|tojson }},
      });
      let nav = document.getElementById("wb-sm");
      if( nav ){
        nav.classList.add("visible-xs");
        nav.classList.add("visible-sm");
      }
      let mobileAppBar = document.getElementsByClassName("app-bar-mb");
      if( mobileAppBar.length > 0 ){
        mobileAppBar[0].classList.remove("visible-xs-block");
        mobileAppBar[0].classList.add("hidden");
      }
    {% else %}
      appTop.outerHTML = wet.builder.top({
        "search": true,
        "lngLinks": [
          {
            "lang": "{{ 'en' if lang == 'fr' else 'fr' }}",
            "href": "{{ h.url_for(h.current_url(), locale=('en' if lang == 'fr' else 'fr')) }}",
            "text": "{{ 'English' if lang == 'fr' else 'Français' }}",
          }
        ],
        "breadcrumbs": {{ breadcrumbs|tojson }},
      });
    {% endif %}
  }
</script>
